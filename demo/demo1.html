<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-16">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.0-rc.1.0/MarkerCluster.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.0-rc.1.0/MarkerCluster.Default.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.0-rc.1.0/leaflet.markercluster.js"></script>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <script src="https://cdn.rawgit.com/adammertel/Leaflet.MarkerCluster.PlacementStrategies/master/dist/leaflet-markercluster.placementstrategies.js"></script>
  <script src="https://cdn.rawgit.com/adammertel/Leaflet.MarkerCluster.PlacementStrategies/master/demo/doctors.js"></script>

  <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow" rel="stylesheet">
</head>

<style>
  body {
    margin: 0px;
    font-family: 'PT Sans Narrow', sans-serif;
  }
  #map-content {
    width: 100%;
    height: 100%;
    margin: 0
  }
  #panel {
    position: absolute;
    height: 90%;
    width: 150px;
    background-color: white;
    top: 2%;
    right: 2%;
    z-index: 999;
    padding-left: 15px;
    opacity: 0.9;
    border: 15px solid white;
    border-opacity: 0;
    font-size: 80%;
  }

  .marker-cluster {
    opacity: 1 !important
  }

  .active-cluster-element {
    opacity: 0.2;
  }

  .select-row {
    margin-top: 4px;
    margin-bottom: 1px;
    margin-left: 5px
  }

  h4 {
    margin-bottom: 2px
  }

  select {
    margin-left: 5px
  }
</style>


<body>

  <div id="map-content"></div>

  <div id="panel">
    <h4>GENERAL</h4>
    <p class="select-row">strategy:</p>
    <select id="strategy-select">
      <option value="default">default</option>
      <option value="spiral">spiral</option>
      <option value="one-circle">one-circle</option>
      <option value="clock">clock</option>
      <option value="clock-concentric" selected>clock-concentric</option>
      <option value="concentric">concentric</option>
    </select>

    <p class="select-row">opacity of base map:</p>
    <select id="mapopacity-select">
      <option value="0.1">0.1</option>
      <option value="0.3">0.3</option>
      <option value="0.5">0.5</option>
      <option value="0.8">0.8</option>
      <option value="1" selected>1</option>
    </select>

    <p class="select-row">base map:</p>
    <select id="base-map">
      <option value="osm" selected>OSM</option>
      <option value="atBase">BasemapAT.basemap</option>
      <option value="osmBW">OSM BlackWhite</option>
      <option value="EsriWorldImagery">ESRI satellite</option>
    </select>

    <h4>ELEMENTS</h4>

    <p class="select-row">shapes:</p>
    <select id="elms-shape-select">
      <option value="circle" selected>circle</option>
      <option value="marker">marker</option>
    </select>

    <p class="select-row">no elements in 1st circle:</p>
    <select id="elms-fcircle-select">
      <option value="6">6</option>
      <option value="8">8</option>
      <option value="10" selected>10</option>
      <option value="12">12</option>
    </select>

    <p class="select-row">elements multiplier:</p>
    <select id="elms-multiplier-select">
      <option value="1.2">1.2</option>
      <option value="1.4">1.4</option>
      <option value="1.5">1.5</option>
      <option value="1.6" selected>1.6</option>
      <option value="1.7">1.7</option>
      <option value="1.8">1.8</option>
      <option value="1.9">1.9</option>
      <option value="2">2</option>
    </select>

    <h4>HELPING CIRCLE</h4>

    <p class="select-row">helping circles:</p>
    <select id="hcircle-turn-select">
      <option value='true' selected>true</option>
      <option value='false'>false</option>
    </select>

    <p class="select-row">color:</p>
    <select id="hcircle-color-select">
      <option value='black'>black</option>
      <option value='dimgray'>dimgray</option>
      <option value='grey' selected>grey</option>
      <option value='darkgrey'>darkgrey</option>
      <option value='silver'>silver</option>
    </select>

    <p class="select-row">stroke weight:</p>
    <select id="hcircle-weight-select">
      <option value='0.2'>0.2</option>
      <option value='0.4'>0.4</option>
      <option value='0.6'>0.6</option>
      <option value='0.8'>0.8</option>
      <option value='1'>1</option>
      <option value='1.2'>1.2</option>
      <option value='1.4'>1.4</option>
      <option value='1.6'>1.6</option>
      <option value='1.8'>1.8</option>
      <option value='2'>2</option>
      <option value='2.2'>2.2</option>
      <option value='2.4'>2.4</option>
      <option value='2.6'>2.6</option>
      <option value='2.8'>2.8</option>
      <option value='3' selected>3</option>
      <option value='3.2'>3.2</option>
      <option value='3.4'>3.4</option>
      <option value='3.6'>3.6</option>
      <option value='3.8'>3.8</option>
    </select>

    <p class="select-row">stroke opacity:</p>
    <select id="hcircle-opacity-select">
      <option value='0.1'>0.1</option>
      <option value='0.2'>0.2</option>
      <option value='0.3'>0.3</option>
      <option value='0.4'>0.4</option>
      <option value='0.5' selected>0.5</option>
      <option value='0.6'>0.6</option>
      <option value='0.7'>0.7</option>
      <option value='0.8'>0.8</option>
      <option value='0.9'>0.9</option>
      <option value='1'>1</option>
    </select>

    <p class="select-row">stroke style:</p>
    <select id="hcircle-style-select">
      <option value='0'>solid</option>
      <option value='.1 4'>.1 4</option>
      <option value='.2 4'>.2 4</option>
      <option value='.4 6'>.4 6</option>
      <option value='.6 6'>.6 6</option>
      <option value='.8 10'>.8 10</option>
      <option value='3'>3</option>
      <option value='5' selected>5</option>
      <option value='6'>6</option>
      <option value='6 7'>6 7</option>
      <option value='6 7.5'>6 7.5</option>
      <option value='6 8'>6 8</option>
      <option value='7'>7</option>
      <option value='3 5'>3 5</option>
      <option value='3 7'>3 7</option>
      <option value='2 4'>2 4</option>
      <option value='2 6'>2 6</option>
      <option value='2 8'>2 8</option>
      <option value='4 8'>4 8</option>
      <option value='10 4 1 4'>10 4 1 4</option>
      <option value='10 6 1 6'>10 4 1 4</option>
    </select>

    <p><i> Data: doctors in Austria </i></p>
  </div>
  <script>

    // global variables
    var map;

    var mapPosition = [47.5, 13.5];
    var mapZoom = 7


    // colorbrewer 2
    var colorsTypes = {
      'Allgemeinmedizin (Praktischer Arzt)': '#8dd3c7',
      'Frauenheilkunde (Gyn�kologie) und Geburtshilfe': '#ffffb3',
      'An�sthesiologie und Intensivmedizin': '#80b1d3',
      'Arbeits- und Betriebsmedizin': '#fdb462',
      'Augenheilkunde und Optometrie': '#b3de69',
      'Blutgruppenserologie und Transfusionsmedizin': '#fdb462',
      'Chirurgie': '#fb8072',
      'Frauenheilkunde (Gyn�kologie) und Geburtshilfe': '#fb8072',
      'Gerichtsmedizin': '#fccde5',
      'Hals-, Nasen- und Ohrenkrankheiten (HNO)': '#d9d9d9',
      'Haut- und Geschlechtskrankheiten': '#bc80bd',
      'Histologie und Embryologie': '#ccebc5',
      'Hygiene und Mikrobiologie': '#ccebc5',
      'Immunologie': '#ccebc5',
      'Innere Medizin': '#ffed6f'
    };

    var circleStyle = function(doctor) {
      // if (!colorsTypes[doctor.properties.type]) {
      //   console.log(doctor.properties.type)
      // }

      return {
        fillColor: colorsTypes[doctor.properties.type],
        radius : 8,
        stroke: true,
        color : 'grey',
        weight: 2.5,
        opacity : 0.7,
        fillOpacity : 1,
        className: 'marker'
      };
    };

    $( document ).ready(function(){
      refreshMap();
      $('select').change(function () {
      	refreshMap()
      })
    });


    function refreshMap () {
      var baseTiles = {
        'osm': L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
          opacity: parseFloat($('#mapopacity-select').val())
        }),
        'osmBW':  L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
        	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
          opacity: parseFloat($('#mapopacity-select').val())
        }),
        'atBase': L.tileLayer('https://maps{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.{format}', {
          attribution: 'Datenquelle: <a href="www.basemap.at">basemap.at</a>',
          subdomains: ["", "1", "2", "3", "4"],
          format: 'png',
          bounds: [[46.35877, 8.782379], [49.037872, 17.189532]],
          opacity: parseFloat($('#mapopacity-select').val())
        }),
        'EsriWorldImagery': L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
          opacity: parseFloat($('#mapopacity-select').val())
        })

      }[$('#base-map').val()];

      if (map) {map.remove();}

      map = L.map('map-content').setView(mapPosition, mapZoom);
      map.on('zoomend', function () { mapZoom = map.getZoom(); });
      map.on('moveend', function () { mapPosition = map.getCenter(); });


      baseTiles.addTo(map);

      // setting map

      console.log({
        spiderLegPolylineOptions: {weight: 0},
        clockHelpingCircleOptions: {
          weight: $('#hcircle-weight-select').val(),
          opacity: $('#hcircle-opacity-select').val(),
          color: $('#hcircle-color-select').val(),
          fillOpacity: 0,
          dashArray: $('#hcircle-style-select').val()
        },

        helpingCircles: $('#hcircle-turn-select').val() === 'true',
        elementsPlacementStrategy: $('#strategy-select').val(),

        spiderfyDistanceSurplus: 25,
        spiderfyDistanceMultiplier: 1,

        elementsMultiplier: parseFloat($('#elms-multiplier-select').val()),
        firstCircleElements: parseInt($('#elms-fcircle-select').val())
      })

      var markers = L.markerClusterGroup({
        spiderLegPolylineOptions: {weight: 0},
        clockHelpingCircleOptions: {
          weight: $('#hcircle-weight-select').val(),
          opacity: $('#hcircle-opacity-select').val(),
          color: $('#hcircle-color-select').val(),
          fillOpacity: 0,
          dashArray: $('#hcircle-style-select').val()
        },

        helpingCircles: $('#hcircle-turn-select').val() === 'true',
        elementsPlacementStrategy: $('#strategy-select').val(),

        spiderfyDistanceSurplus: 25,
        spiderfyDistanceMultiplier: 1,

        elementsMultiplier: parseFloat($('#elms-multiplier-select').val()),
        firstCircleElements: parseInt($('#elms-fcircle-select').val())
      });


      // Parse doctors data
      for (var di in doctors.features) {
        var doctor = doctors.features[di];

        var marker;
        if ($('#elms-shape-select').val() === 'circle') {
          marker = L.circleMarker([doctor.geometry.coordinates[1], doctor.geometry.coordinates[0]], circleStyle(doctor));
        } else {
          marker = L.marker([doctor.geometry.coordinates[1], doctor.geometry.coordinates[0]]);
        }

        marker.bindPopup("<h3>" + doctor.properties.name + "</h3>" + "<p>" + doctor.properties.type + "</p>" + "<p>" + doctor.properties.address + "</p>");

        markers.addLayer(marker);
      }

      console.log(markers)
      map.addLayer(markers);
    }

  </script>
</body>

</html>
